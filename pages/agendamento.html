<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendamento de Servi√ßos - Minimercado Bom Pre√ßo</title>
    <meta name="description" content="Agende sua retirada no local ou tele-entrega do Minimercado Bom Pre√ßo. Escolha data e hor√°rio de sua prefer√™ncia.">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- CSS Customizado -->
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/responsive.css">
    <link rel="stylesheet" href="../assets/css/accessibility.css">
</head>
<body>
    <!-- Skip Links para Acessibilidade -->
    <div class="skip-links">
        <a href="#main-content" class="skip-link">Pular para conte√∫do principal</a>
        <a href="#navigation" class="skip-link">Pular para navega√ß√£o</a>
    </div>

    <header>
        <div class="container">
            <h1>Minimercado Bom Pre√ßo</h1>
            <p>Qualidade e Economia para sua Fam√≠lia</p>

            <nav id="navigation" role="navigation" aria-label="Navega√ß√£o principal">
                <ul>
                    <li><a href="../index.html">In√≠cio</a></li>
                    <li><a href="produtos.html">Produtos</a></li>
                    <li><a href="servicos.html">Servi√ßos</a></li>
                    <li><a href="contato.html">Contato</a></li>
                    <li><a href="cadastro.html">Cadastro</a></li>
                    <li><a href="agendamento.html" aria-current="page">Agendamento</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main id="main-content" class="container my-5">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <header class="text-center mb-5">
                    <h2>Agendamento de Servi√ßos</h2>
                    <p class="lead">Escolha o tipo de servi√ßo, data e hor√°rio de sua prefer√™ncia</p>
                </header>

                <!-- SELE√á√ÉO DE SERVI√áO -->
                <section class="mb-5">
                    <div class="card">
                        <div class="card-header">
                            <h3>1. Selecione o Tipo de Servi√ßo</h3>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card h-100 servico-card" data-servico="retirada">
                                        <div class="card-body text-center">
                                            <div class="display-4 text-primary mb-3">üè™</div>
                                            <h4 class="card-title">Retirada no Local</h4>
                                            <p class="card-text">Venha at√© nossa loja e retire seus produtos</p>
                                            <ul class="list-unstyled">
                                                <li>‚úÖ Gratuito</li>
                                                <li>‚úÖ Escolha pessoal dos produtos</li>
                                                <li>‚úÖ Hor√°rio: 07:00 √†s 20:00</li>
                                            </ul>
                                            <button class="btn btn-outline-primary btn-select-service"
                                                    data-servico="retirada"
                                                    aria-describedby="desc-retirada">
Selecionar Retirada
                                            </button>
                                            <div id="desc-retirada" class="sr-only">
Servi√ßo gratuito onde voc√™ vem at√© nossa loja para retirar os produtos
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6">
                                    <div class="card h-100 servico-card" data-servico="entrega">
                                        <div class="card-body text-center">
                                            <div class="display-4 text-success mb-3">üöö</div>
                                            <h4 class="card-title">Tele-entrega</h4>
                                            <p class="card-text">Receba seus produtos em casa</p>
                                            <ul class="list-unstyled">
                                                <li>üí∞ R$ 5,00 (Gr√°tis acima de R$ 50)</li>
                                                <li>‚úÖ Comodidade total</li>
                                                <li>‚úÖ Hor√°rio: 08:00 √†s 19:00</li>
                                            </ul>
                                            <button class="btn btn-outline-success btn-select-service"
                                                    data-servico="entrega"
                                                    aria-describedby="desc-entrega">
Selecionar Entrega
                                            </button>
                                            <div id="desc-entrega" class="sr-only">
Servi√ßo de entrega em domic√≠lio com taxa de R$ 5,00, gratuito para compras acima de R$ 50
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- INFORMA√á√ïES DO CLIENTE -->
                <section class="mb-5" id="info-cliente">
                    <div class="card">
                        <div class="card-header">
                            <h3>2. Suas Informa√ß√µes</h3>
                        </div>
                        <div class="card-body">
                            <form id="form-info-cliente">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="cliente-nome" class="form-label required">Nome Completo:</label>
                                            <input type="text"
                                                   class="form-control"
                                                   id="cliente-nome"
                                                   name="nome"
                                                   required
                                                   placeholder="Seu nome completo">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label for="cliente-telefone" class="form-label required">Telefone:</label>
                                            <input type="tel"
                                                   class="form-control"
                                                   id="cliente-telefone"
                                                   name="telefone"
                                                   required
                                                   placeholder="(11) 99999-9999">
                                        </div>
                                    </div>
                                </div>

                                <!-- Endere√ßo para entrega -->
                                <div id="endereco-entrega" class="hidden" aria-live="polite">
                                    <hr>
                                    <h4>Endere√ßo de Entrega</h4>
                                    <p class="text-muted">Este campo ser√° exibido apenas para entregas em domic√≠lio</p>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label for="entrega-cep" class="form-label">CEP:</label>
                                                <input type="text"
                                                       class="form-control"
                                                       id="entrega-cep"
                                                       name="cep"
                                                       placeholder="00000-000">
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label for="entrega-rua" class="form-label">Rua:</label>
                                                <input type="text"
                                                       class="form-control"
                                                       id="entrega-rua"
                                                       name="rua"
                                                       placeholder="Nome da rua">
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="mb-3">
                                                <label for="entrega-numero" class="form-label">N√∫mero:</label>
                                                <input type="text"
                                                       class="form-control"
                                                       id="entrega-numero"
                                                       name="numero"
                                                       placeholder="123">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label for="entrega-complemento" class="form-label">Complemento:</label>
                                                <input type="text"
                                                       class="form-control"
                                                       id="entrega-complemento"
                                                       name="complemento"
                                                       placeholder="Apto, bloco, etc.">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label for="entrega-bairro" class="form-label">Bairro:</label>
                                                <input type="text"
                                                       class="form-control"
                                                       id="entrega-bairro"
                                                       name="bairro"
                                                       placeholder="Nome do bairro">
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="mb-3">
                                                <label for="entrega-cidade" class="form-label">Cidade:</label>
                                                <input type="text"
                                                       class="form-control"
                                                       id="entrega-cidade"
                                                       name="cidade"
                                                       placeholder="Nome da cidade">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </section>

                <!-- CALEND√ÅRIO -->
                <section class="mb-5 opacity-50" id="secao-calendario" aria-disabled="true">
                    <div class="card">
                        <div class="card-header">
                            <h3>3. Escolha Data e Hor√°rio <span class="badge bg-secondary ms-2">Preencha os dados acima</span></h3>
                        </div>
                        <div class="card-body">
                            <!-- Tabela de hor√°rios de funcionamento -->
                            <div class="mb-4">
                                <h4>Hor√°rios de Funcionamento</h4>
                                <div class="table-responsive">
                                    <table class="table table-striped table-sm">
                                        <thead class="table-dark">
                                            <tr>
                                                <th scope="col">Dia da Semana</th>
                                                <th scope="col">Retirada no Local</th>
                                                <th scope="col">Tele-entrega</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <th scope="row">Segunda-feira</th>
                                                <td>07:00 - 20:00</td>
                                                <td>08:00 - 19:00</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Ter√ßa-feira</th>
                                                <td>07:00 - 20:00</td>
                                                <td>08:00 - 19:00</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Quarta-feira</th>
                                                <td>07:00 - 20:00</td>
                                                <td>08:00 - 19:00</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Quinta-feira</th>
                                                <td>07:00 - 20:00</td>
                                                <td>08:00 - 19:00</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">Sexta-feira</th>
                                                <td>07:00 - 20:00</td>
                                                <td>08:00 - 19:00</td>
                                            </tr>
                                            <tr>
                                                <th scope="row">S√°bado</th>
                                                <td>07:00 - 18:00</td>
                                                <td>08:00 - 17:00</td>
                                            </tr>
                                            <tr class="table-warning">
                                                <th scope="row">Domingo</th>
                                                <td>08:00 - 14:00</td>
                                                <td>Fechado</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Widget de calend√°rio -->
                            <div id="calendario-agendamento" role="application" aria-label="Calend√°rio de agendamento">
                                <!-- Conte√∫do gerado dinamicamente -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- RESUMO DO AGENDAMENTO -->
                <section class="mb-5 hidden" id="resumo-agendamento">
                    <div class="card">
                        <div class="card-header bg-success text-white">
                            <h3>4. Confirma√ß√£o do Agendamento</h3>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info" role="alert">
                                <h4 class="alert-heading">Revise os dados do seu agendamento</h4>
                                <p class="mb-0">Confira se todas as informa√ß√µes est√£o corretas antes de confirmar.</p>
                            </div>

                            <!-- Tabela de resumo -->
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th scope="col" class="w-30">Item</th>
                                            <th scope="col">Detalhes</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <th scope="row">Tipo de Servi√ßo</th>
                                            <td id="resumo-servico">-</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">Cliente</th>
                                            <td id="resumo-cliente">-</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">Telefone</th>
                                            <td id="resumo-telefone">-</td>
                                        </tr>
                                        <tr id="linha-endereco" class="hidden">
                                            <th scope="row">Endere√ßo</th>
                                            <td id="resumo-endereco">-</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">Data</th>
                                            <td id="resumo-data">-</td>
                                        </tr>
                                        <tr>
                                            <th scope="row">Hor√°rio</th>
                                            <td id="resumo-horario">-</td>
                                        </tr>
                                        <tr class="table-success">
                                            <th scope="row">Taxa de Entrega</th>
                                            <td id="resumo-taxa">R$ 0,00</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>

                            <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-3">
                                <button type="button" class="btn btn-outline-secondary me-md-2" onclick="voltarEtapa()">
‚Üê Voltar
                                </button>
                                <button type="button" class="btn btn-success btn-lg" onclick="confirmarAgendamentoFinal()">
                                    ‚úÖ Confirmar Agendamento
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- AGENDAMENTO CONFIRMADO -->
                <section class="mb-5 hidden" id="agendamento-confirmado">
                    <div class="card border-success">
                        <div class="card-header bg-success text-white text-center">
                            <h3>üéâ Agendamento Confirmado!</h3>
                        </div>
                        <div class="card-body text-center">
                            <div class="alert alert-success" role="alert">
                                <h4 class="alert-heading">Sucesso!</h4>
                                <p>Seu agendamento foi confirmado com sucesso.</p>
                                <hr>
                                <p class="mb-0">Voc√™ receber√° uma confirma√ß√£o por WhatsApp ou telefone em breve.</p>
                            </div>

                            <div class="mb-4">
                                <h5>N√∫mero do Agendamento</h5>
                                <div class="display-6 text-primary" id="numero-agendamento">-</div>
                            </div>

                            <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                                <a href="../index.html" class="btn btn-primary">Voltar ao In√≠cio</a>
                                <a href="produtos.html" class="btn btn-outline-primary">Ver Produtos</a>
                                <button type="button" class="btn btn-outline-secondary" onclick="novoAgendamento()">
                                    Novo Agendamento
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <footer id="footer">
        <div class="container">
            <section>
                <h2>Contato</h2>
                <p>
                    <strong>Telefone:</strong> (51) 3333-4444<br>
                    <strong>WhatsApp:</strong> (51) 99999-8888<br>
                    <strong>E-mail:</strong> contato@minimercadobompreco.com.br
                </p>
            </section>

            <section>
                <h2>Navega√ß√£o</h2>
                <nav>
                    <ul>
                        <li><a href="../index.html">In√≠cio</a></li>
                        <li><a href="produtos.html">Produtos</a></li>
                        <li><a href="servicos.html">Servi√ßos</a></li>
                        <li><a href="contato.html">Contato</a></li>
                        <li><a href="cadastro.html">Cadastro</a></li>
                        <li><a href="agendamento.html">Agendamento</a></li>
                    </ul>
                </nav>
            </section>

            <section>
                <h2>Informa√ß√µes Legais</h2>
                <p>
                    <strong>Minimercado Bom Pre√ßo Ltda.</strong><br>
                    CNPJ: 12.345.678/0001-90<br>
                    Inscri√ß√£o Municipal: 123456789
                </p>

                <p>
                    <small>
                        ¬© 2025 Minimercado Bom Pre√ßo. Todos os direitos reservados.<br>
                        Site desenvolvido como projeto acad√™mico - Fundamentos de Sistemas Web - PUCRS
                    </small>
                </p>
            </section>
        </div>
    </footer>

    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JavaScript Customizado -->
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/forms.js"></script>
    <script src="../assets/js/calendar.js"></script>
    <script src="../assets/js/accessibility.js"></script>

    <!-- Estilos espec√≠ficos da p√°gina -->
    <style>
        .servico-card {
            transition: box-shadow 0.2s ease;
            cursor: pointer;
        }

        .servico-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .servico-card:focus-within {
            outline: 3px solid var(--primary-color, #2c5530);
            outline-offset: 2px;
        }

        .border-3 {
            border-width: 3px !important;
        }

        .opacity-50 {
            opacity: 0.5;
            pointer-events: none;
        }

        [aria-disabled="true"] {
            cursor: not-allowed;
        }

        [aria-disabled="true"] * {
            pointer-events: none;
        }

        .badge {
            font-size: 0.75rem;
        }

        /* Melhorar indicadores visuais */
        .card-header .badge {
            font-weight: 500;
        }

        /* Anima√ß√£o suave para transi√ß√µes de estado */
        .card {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        /* Melhor feedback visual para sele√ß√£o */
        .btn-select-service:focus {
            outline: 2px solid currentColor;
            outline-offset: 2px;
        }
    </style>

    <script>
        // JavaScript espec√≠fico da p√°gina de agendamento
        let dadosAgendamento = {
            servico: null,
            cliente: {},
            data: null,
            horario: null
        };

        document.addEventListener('DOMContentLoaded', function() {
            console.log('P√°gina de agendamento carregada');

            // Event listeners para sele√ß√£o de servi√ßo
            document.querySelectorAll('.btn-select-service').forEach(btn => {
                btn.addEventListener('click', function() {
                    selecionarServico(this.dataset.servico);
                });
            });

            // Event listener para formul√°rio de cliente
            document.getElementById('form-info-cliente').addEventListener('input', function() {
                atualizarDadosCliente();
            });
        });

        function selecionarServico(tipoServico) {
            dadosAgendamento.servico = tipoServico;

            // Atualizar visual dos cards
            document.querySelectorAll('.servico-card').forEach(card => {
                card.classList.remove('border-primary', 'border-success', 'border-3');
            });

            const cardSelecionado = document.querySelector(`[data-servico="${tipoServico}"]`);
            cardSelecionado.classList.add(
                tipoServico === 'retirada' ? 'border-primary' : 'border-success',
                'border-3'
            );

            // Mostrar/esconder endere√ßo com feedback acess√≠vel
            const enderecoDiv = document.getElementById('endereco-entrega');
            const liveRegion = document.getElementById('live-region') || document.createElement('div');

            if (tipoServico === 'entrega') {
                enderecoDiv.style.display = 'block';
                enderecoDiv.setAttribute('aria-expanded', 'true');

                // Tornar campos obrigat√≥rios
                enderecoDiv.querySelectorAll('input').forEach(input => {
                    if (['cep', 'rua', 'numero', 'bairro', 'cidade'].includes(input.name)) {
                        input.required = true;
                        input.setAttribute('aria-required', 'true');
                    }
                });

                // Anunciar para leitores de tela
                if (liveRegion.id === 'live-region') {
                    liveRegion.textContent = 'Servi√ßo de entrega selecionado. Campos de endere√ßo agora s√£o obrigat√≥rios.';
                }
            } else {
                enderecoDiv.style.display = 'none';
                enderecoDiv.setAttribute('aria-expanded', 'false');

                // Remover obrigatoriedade dos campos
                enderecoDiv.querySelectorAll('input').forEach(input => {
                    input.required = false;
                    input.removeAttribute('aria-required');
                    input.value = ''; // Limpar valores
                });

                // Anunciar para leitores de tela
                if (liveRegion.id === 'live-region') {
                    liveRegion.textContent = 'Servi√ßo de retirada selecionado. Campos de endere√ßo n√£o s√£o necess√°rios.';
                }
            }

            // Focar no primeiro campo obrigat√≥rio n√£o preenchido
            const primeiroVazio = document.querySelector('#info-cliente input[required]:not([value]), #info-cliente input[required][value=""]');
            if (primeiroVazio) {
                setTimeout(() => primeiroVazio.focus(), 100);
            }
        }

        function atualizarDadosCliente() {
            const form = document.getElementById('form-info-cliente');
            const formData = new FormData(form);

            dadosAgendamento.cliente = {
                nome: formData.get('nome'),
                telefone: formData.get('telefone'),
                endereco: {
                    cep: formData.get('cep'),
                    rua: formData.get('rua'),
                    numero: formData.get('numero'),
                    complemento: formData.get('complemento'),
                    bairro: formData.get('bairro'),
                    cidade: formData.get('cidade')
                }
            };

            // Validar campos obrigat√≥rios baseado no tipo de servi√ßo
            let camposValidos = dadosAgendamento.cliente.nome && dadosAgendamento.cliente.telefone;

            if (dadosAgendamento.servico === 'entrega') {
                camposValidos = camposValidos &&
                               dadosAgendamento.cliente.endereco.cep &&
                               dadosAgendamento.cliente.endereco.rua &&
                               dadosAgendamento.cliente.endereco.numero &&
                               dadosAgendamento.cliente.endereco.bairro &&
                               dadosAgendamento.cliente.endereco.cidade;
            }

            // Atualizar indicador visual de progresso
            const calendarioSection = document.getElementById('secao-calendario');
            const calendarioHeader = calendarioSection.querySelector('.card-header h3');

            if (camposValidos) {
                calendarioHeader.innerHTML = '3. Escolha Data e Hor√°rio <span class="badge bg-success ms-2">Pronto para sele√ß√£o</span>';
                calendarioSection.classList.remove('opacity-50');
                calendarioSection.removeAttribute('aria-disabled');
            } else {
                calendarioHeader.innerHTML = '3. Escolha Data e Hor√°rio <span class="badge bg-secondary ms-2">Preencha os dados acima</span>';
                calendarioSection.classList.add('opacity-50');
                calendarioSection.setAttribute('aria-disabled', 'true');
            }
        }

        function confirmarAgendamentoFinal() {
            // Gerar n√∫mero do agendamento
            const numeroAgendamento = 'AG' + Date.now().toString().substr(-8);

            // Salvar no localStorage
            const agendamento = {
                numero: numeroAgendamento,
                ...dadosAgendamento,
                timestamp: new Date().toISOString()
            };

            localStorage.setItem('ultimo_agendamento', JSON.stringify(agendamento));

            // Mostrar confirma√ß√£o
            document.getElementById('numero-agendamento').textContent = numeroAgendamento;
            document.getElementById('agendamento-confirmado').style.display = 'block';
            document.getElementById('resumo-agendamento').style.display = 'none';

            document.getElementById('agendamento-confirmado').scrollIntoView({ behavior: 'smooth' });
        }

        function voltarEtapa() {
            document.getElementById('resumo-agendamento').style.display = 'none';

            // Focar no calend√°rio para melhor acessibilidade
            const calendario = document.getElementById('calendario-agendamento');
            if (calendario) {
                calendario.focus();
                calendario.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function novoAgendamento() {
            location.reload();
        }

        // Callback para quando data/hor√°rio for selecionado no calend√°rio
        window.onAgendamentoSelecionado = function(data, horario) {
            dadosAgendamento.data = data;
            dadosAgendamento.horario = horario;

            // Atualizar resumo
            atualizarResumo();

            // Mostrar resumo
            document.getElementById('resumo-agendamento').style.display = 'block';
            document.getElementById('resumo-agendamento').scrollIntoView({ behavior: 'smooth' });
        };

        function atualizarResumo() {
            document.getElementById('resumo-servico').textContent =
                dadosAgendamento.servico === 'retirada' ? 'Retirada no Local' : 'Tele-entrega';

            document.getElementById('resumo-cliente').textContent = dadosAgendamento.cliente.nome;
            document.getElementById('resumo-telefone').textContent = dadosAgendamento.cliente.telefone;

            if (dadosAgendamento.servico === 'entrega') {
                const endereco = dadosAgendamento.cliente.endereco;
                const enderecoFormatado = `${endereco.rua}, ${endereco.numero}${endereco.complemento ? ' - ' + endereco.complemento : ''}, ${endereco.bairro}, ${endereco.cidade}`;
                document.getElementById('resumo-endereco').textContent = enderecoFormatado;
                document.getElementById('linha-endereco').style.display = 'table-row';
                document.getElementById('resumo-taxa').textContent = 'R$ 5,00';
            } else {
                document.getElementById('linha-endereco').style.display = 'none';
                document.getElementById('resumo-taxa').textContent = 'R$ 0,00';
            }

            if (dadosAgendamento.data) {
                document.getElementById('resumo-data').textContent =
                    dadosAgendamento.data.toLocaleDateString('pt-BR', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
            }

            document.getElementById('resumo-horario').textContent = dadosAgendamento.horario || '-';
        }
    </script>
</body>
</html>
